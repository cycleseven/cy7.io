import { Meta } from "@storybook/addon-docs";

<Meta title="Guides / Project layout" />

# Project layout

The codebase is a TypeScript/Gatsby project, and looks something like this.

```
- .github/
  - workflows/
- .storybook/
- deploy/
  - infra/
  - lambda/
- generated/ (*)
  - @cy7/
    - gql-types/
- node_modules/ (*)
- public/ (*)
- src/
  - @cy7/
    - design-system/
    - docs/
    - gatsby-plugin-stitches/
    - typography/
    - website/
      - blog/
      - common/
      - home/
  - images/
  - pages/
  - templates/
- storybook-static/ (*)
- [top-level files like package.json, gatsby-config.js, etc]
```

> üí° **Directories marked with (*) are generated by tooling.**
> - They may not exist yet on a fresh clone of the repository.
> - Developers shouldn't edit these files directly.

## A quick tour

If you've worked with Gatsby, Storybook or GitHub Actions before, hopefully some of this feels relatively familiar. The directories are are...

**`.github/workflows`**

Defines workflows and jobs for Github Actions, which the project uses for automated builds (or CI/CD, if you like).

**`.storybook`**

Configuration for [Storybook](https://storybook.js.org/docs/react/configure/overview).

**`deploy`**

All code related to hosting and deployment lives under here.

- **`deploy/infra`** is a Terraform configuration that defines the AWS resources used to host the site.
- **`deploy/lambda`** is a [Serverless Framework](http://serverless.com) project that manages a handful of AWS Lambda functions used via Lambda@Edge. These functions implement any custom server logic that's executed when handling requests in CloudFront.

The [Deployment](/docs/guides-deployment--page) guide explores this part of the codebase further.

**`generated`**

Auto-generated packages live here. Currently, this is used for a single purpose, which is to hold GraphQL types generated by [gatsby-plugin-graphql-codegen](https://github.com/d4rekanguok/gatsby-typescript/tree/master/packages/gatsby-plugin-graphql-codegen).

Read the [TypeScript](/docs/guides-typescript--page) guide to learn more about using generated GraphQL types.

**`public`**

[Gatsby's build output](https://www.gatsbyjs.com/docs/conceptual/overview-of-the-gatsby-build-process/). Generated by running `gatsby build`. These are the files served by the production website.

**`src`**

The source code for the frontend site itself. Most development work happens in here.

The sub-directories `pages/` and `templates/` act [as they typically do in Gatsby projects](https://www.gatsbyjs.com/docs/reference/gatsby-project-structure/).

- Gatsby automatically creates a page in the site's URL structure for each component defined in `pages/`.
- Components in `templates/` are used when programatically generating pages from data sources, eg. blog articles.
- Assets in `images/` are made available via [gatsby-source-filesystem](https://www.gatsbyjs.com/docs/how-to/sourcing-data/sourcing-from-the-filesystem/) for use with [gatsby-plugin-image](https://www.gatsbyjs.com/plugins/gatsby-plugin-image).

The `src/@cy7` directory hosts the majority of the frontend code. You can think of this directory as a set of mini-packages.

- **`@cy7/design-system`:** reusable visual building blocks for pages on cy7.io, including the [Stitches config](https://stitches.dev/docs/installation#configure-stitches).
- **`@cy7/docs`:** code for the Storybook docs site (that's this one!).
- **`@cy7/gatsby-plugin-stitches`:** a minimal Gatsby plugin that integrates Stitches SSR with Gatsby, based on [this tutorial](https://stitches.dev/blog/using-gatsby-with-stitches).
- **`@cy7/typography`:** configures [Typography.js](https://github.com/KyleAMathews/typography.js), which defines global base styles for text elements. (‚ö†Ô∏è **Note:** a future migration away from Typography.js is planned.)
- **`@cy7/website`:** code that's specific to the [cy7.io](http://cy7.io) Gatsby site. Gatsby layout components live here, and so do utility functions to help bridge data sources to UI: see `@cy7/website/common`. Page-specific components live here too: the `@cy7/website/blog` and `@cy7/website/home` directories provide a home to extract components to when `pages` and `templates` start to get out of hand.

See the [`Design system`](/docs/design-system-getting-started--no-margins-by-default) and [Website](/docs/website-overview--page) reference docs here in Storybook to explore the reusable components available for building pages.

## Where your code should live

- If you'd like to extract one-off code from a Gatsby page or template that's growing too large, the recommended home is a new sub-package under `@cy7/website`.
- Code intended for reuse across the Gatsby project belongs in `@cy7/website/common`.
- Fundamental visual components that could be reused in other React projects form the design system, and live in `@cy7/design-system`.

Don't worry about "polluting" `@cy7` with new packages for code that doesn't fit any of the above categories. There's no overhead to creating new internal packages, and a flat code structure can often be easier to reason about than a highly nested one.

### Does my component belong in the design system?

Deciding whether your reusable component belongs in `@cy7/website/common` or `@cy7/design-system` can be tricky. These pointers may help:

- Components named after generic UI elements like `<Button />`, `<Dialog />` or `<Stack />` are usually good candidates for the design system. Check out some design systems and component libraries like [Braid](https://seek-oss.github.io/braid-design-system/) or [Material UI](https://material-ui.com/) for inspiration.
- Components that "know about" Gatsby _don't_ belong in the design system. In particular, this means components with `useStaticQuery()`, components that make use of Gatsby APIs like `gatsby-plugin-image`, `<Link />`, or are designed to be used with the Gatsby Head API.
